(this["webpackJsonpcreate-react-app"]=this["webpackJsonpcreate-react-app"]||[]).push([[0],{133:function(e,t,n){},134:function(e,t,n){},135:function(e,t,n){"use strict";n.r(t);var r,a=n(36),s=n.n(a),o=n(198),c=n(195),i=n(41),u=n(101),l=Object(u.a)({palette:{primary:{main:"#556cd6"},secondary:{main:"#19857b"},error:{main:i.a.A400}}}),d=n(15),h=n(16),f=n(19),p=n(20),b=n(0),g=n.n(b),v=n(17),m=n(18),y=n(10),S=n.n(y),C=n(92),k=n(62),j=function(){function e(){Object(d.a)(this,e),this.drawers=[],this.changecount=0,this.uichild=void 0,this.state={changecount:0,currentdrawer:"Status"},console.log("DashboardController constructor()")}return Object(h.a)(e,[{key:"getCurrentDrawer",value:function(){return this.state.currentdrawer}},{key:"setUIElement",value:function(e){console.log("setUIElement: ",this),this.uichild=e,this.signalChange()}},{key:"findDrawer",value:function(e){return this.drawers.find((function(t){return t.name==e}))}},{key:"findInDrawer",value:function(e,t){var n=this.findDrawer(e);if(void 0!==n)return n.contents.find((function(e){return e.name===t}))}},{key:"addDrawer",value:function(e,t,n){var r;if(void 0!==this.findDrawer(e))throw Error("Drawer "+e+" already exists");r=void 0!==n?{name:e,draweritem:t,contents:n}:{name:e,draweritem:t,contents:[]},this.drawers.push(r),this.signalChange(),console.log("After addDrawer:",this)}},{key:"signalChange",value:function(){this.changecount=this.changecount+1,this.uichild&&this.uichild.setState({changecount:this.changecount})}},{key:"addItem",value:function(e,t,n,r){var a=this.findDrawer(t);if(void 0===a)throw Error("Couldn't find drawer "+t);a.contents.push({name:e,item:n,visible:r}),this.signalChange()}},{key:"setItemVisible",value:function(e,t,n){var r=this,a=this.findDrawer(t);void 0!==a&&a.contents.forEach((function(t){t.name==e&&t.visible!==n&&(t.visible=n,r.signalChange())}))}},{key:"setActiveDrawer",value:function(e){console.log("setActiveDrawer(",e,")"),console.log("After setActiveDrawer: ",this),this.state.currentdrawer=e,this.signalChange()}},{key:"removeItem",value:function(e,t){var n=this.findDrawer(t);void 0!==n&&(n.contents=n.contents.filter((function(t,n,r){return t.name!==e})),this.signalChange())}}]),e}(),M=n(14);[[0,"ExternalFlash",1048575,"Flash RW"],[8388608,"HWConfig",4,"HWConfig"],[8388612,"Model",4,"Model"],[8388616,"CPUBoardModel",4,"CPU Board Model * 1000. eg: 1100 = 1.1"],[8388620,"v13Model",4,"v1.3+ Firmware Model (Unset = 0, DE1 = 1, DE1Plus = 2, DE1Pro = 3, DE1XL = 4, DE1Cafe = 5)"],[8388624,"CPUFirmwareBuild",4,"CPU Board Firmware build number. (Starts at 1000 for 1.3, increments by 1 for every build)"],[8398848,"DebugLen",4,"How many characters in debug buffer are valid. Accessing this pauses BLE debug logging."],[8398852,"DebugBuffer",4096,"Last 4K of output. Zero terminated if buffer not full yet. Pauses BLE debug logging."],[8402948,"DebugConfig",4,"BLEDebugConfig. (Reading restarts logging into the BLE log)"],[8402952,"FanThreshold",4,"Fan threshold temp"],[8402956,"TankTemp",4,"Tank water temp threshold."],[8402960,"HeaterUp1Flow",4,"HeaterUp Phase 1 Flow Rate"],[8402964,"HeaterUp2Flow",4,"HeaterUp Phase 2 Flow Rate"],[8402968,"WaterHeaterIdleTemp",4,"Water Heater Idle Temperature"],[8402972,"GHCInfo",4,"GHC Info Bitmask, 0x1 = GHC LED Controller Present, 0x2 = GHC Touch Controller_Present, 0x4 GHC Active, 0x80000000 = Factory Mode"],[8402976,"PrefGHCMCI",4,"TODO"],[8402980,"MaxShotPres",4,"TODO"],[8402984,"TargetSteamFlow",4,"Target steam flow rate"],[8402988,"SteamStartSecs",4,"Seconds of high steam flow * 100. Valid range 0.0 - 4.0. 0 may result in an overheated heater. Be careful."],[8402992,"SerialN",4,"Current serial number"],[8402996,"HeaterV",4,"Nominal Heater Voltage (0, 120V or 230V). +1000 if it's a set value."],[8403e3,"HeaterUp2Timeout",4,"HeaterUp Phase 2 Timeout"],[8403004,"CalFlowEst",4,"Flow Estimation Calibration"],[8403008,"FlushFlowRate",4,"Flush Flow Rate"],[8403012,"FlushTemp",4,"Flush Temp"],[8403016,"FlushTimeout",4,"Flush Timeout"],[8403020,"HotWaterFlowRate",4,"Hot Water Flow Rate"],[8403024,"SteamPurgeMode",4,"Steam Purge Mode"],[8403028,"AllowUSBCharging",4,"Allow USB charging"],[8403032,"AppFeatureFlags",4,"App Feature Flags"],[8403036,"RefillKitPresent",4,"Refill Kit Present"]].map((function(e,t,n){return[e[1],e[0]]}));!function(e){e[e.ExternalFlash=0]="ExternalFlash",e[e.HWConfig=8388608]="HWConfig",e[e.Model=8388612]="Model",e[e.CPUBoardModel=8388616]="CPUBoardModel",e[e.v13Model=8388620]="v13Model",e[e.CPUFirmwareBuild=8388624]="CPUFirmwareBuild",e[e.DebugLen=8398848]="DebugLen",e[e.DebugBuffer=8398852]="DebugBuffer",e[e.DebugConfig=8402948]="DebugConfig",e[e.FanThreshold=8402952]="FanThreshold",e[e.TankTemp=8402956]="TankTemp",e[e.HeaterUp1Flow=8402960]="HeaterUp1Flow",e[e.HeaterUp2Flow=8402964]="HeaterUp2Flow",e[e.WaterHeaterIdleTemp=8402968]="WaterHeaterIdleTemp",e[e.GHCInfo=8402972]="GHCInfo",e[e.PrefGHCMCI=8402976]="PrefGHCMCI",e[e.MaxShotPres=8402980]="MaxShotPres",e[e.TargetSteamFlow=8402984]="TargetSteamFlow",e[e.SteamStartSecs=8402988]="SteamStartSecs",e[e.SerialN=8402992]="SerialN",e[e.HeaterV=8402996]="HeaterV",e[e.HeaterUp2Timeout=8403e3]="HeaterUp2Timeout",e[e.CalFlowEst=8403004]="CalFlowEst",e[e.FlushFlowRate=8403008]="FlushFlowRate",e[e.FlushTemp=8403012]="FlushTemp",e[e.FlushTimeout=8403016]="FlushTimeout",e[e.HotWaterFlowRate=8403020]="HotWaterFlowRate",e[e.SteamPurgeMode=8403024]="SteamPurgeMode",e[e.AllowUSBCharging=8403028]="AllowUSBCharging",e[e.AppFeatureFlags=8403032]="AppFeatureFlags",e[e.RefillKitPresent=8403036]="RefillKitPresent"}(r||(r={}));var w,O,x=n(21),R=n(52),D=n.n(R),E=n(63);!function(e){e.Versions="0000a001-0000-1000-8000-00805f9b34fb",e.RequestedState="0000a002-0000-1000-8000-00805f9b34fb",e.SetTime="0000a003-0000-1000-8000-00805f9b34fb",e.ShotDirectory="0000a004-0000-1000-8000-00805f9b34fb",e.ReadFromMMR="0000a005-0000-1000-8000-00805f9b34fb",e.WriteToMMR="0000a006-0000-1000-8000-00805f9b34fb",e.ShotMapRequest="0000a007-0000-1000-8000-00805f9b34fb",e.DeleteShotRange="0000a008-0000-1000-8000-00805f9b34fb",e.FWMapRequest="0000a009-0000-1000-8000-00805f9b34fb",e.Temperatures="0000a00a-0000-1000-8000-00805f9b34fb",e.ShotSettings="0000a00b-0000-1000-8000-00805f9b34fb",e.Deprecated="0000a00c-0000-1000-8000-00805f9b34fb",e.ShotSample="0000a00d-0000-1000-8000-00805f9b34fb",e.StateInfo="0000a00e-0000-1000-8000-00805f9b34fb",e.HeaderWrite="0000a00f-0000-1000-8000-00805f9b34fb",e.FrameWrite="0000a010-0000-1000-8000-00805f9b34fb",e.WaterLevels="0000a011-0000-1000-8000-00805f9b34fb",e.Calibration="0000a012-0000-1000-8000-00805f9b34fb"}(w||(w={})),function(e){e[e.Versions=12]="Versions",e[e.FWMapRequest=7]="FWMapRequest"}(O||(O={}));D()(">BBB");var T=D()(">16s"),A=D()(">B3B16s");function _(e,t){var n=t>>16&255,r=t>>8&255,a=255&t,s=T.unpack(e)[0];return A.pack(e.byteLength,n,r,a,s)}var I=D()(">HBB3B");function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=r>>16&255,s=r>>8&255,o=255&r;return I.pack(e,t,n,a,s,o)}function F(e){var t=Object(E.a)(e),n=I.unpack(t),r=Object(x.a)(n,4);return{WindowIncrement:r[0],FWToErase:r[1],FWToMap:r[2],FirstError:r[3]}}var N=null,W=function(e){return console.log("FWMRCallback: ",e),N=e,!0};function U(e,t){return q.apply(this,arguments)}function q(){return(q=Object(m.a)(S.a.mark((function e(t,n){var r,a;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=N)){e.next=5;break}if("GATTNotify"!=r.update){e.next=5;break}return a=r,e.abrupt("return",{success:!0,result:F(a.results.Data)});case 5:return e.abrupt("return",{success:!1});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t){return B.apply(this,arguments)}function B(){return B=Object(m.a)(S.a.mark((function e(t,n){var r,a,s,o,c=arguments;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>2&&void 0!==c[2]?c[2]:0,a=c.length>3&&void 0!==c[3]?c[3]:0,s=c.length>4&&void 0!==c[4]?c[4]:0,o=c.length>5&&void 0!==c[5]?c[5]:0,e.next=6,t.requestAsyncGATTWrite(n,w.FWMapRequest,L(r,a,s,o),!0);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))),B.apply(this,arguments)}function H(e,t,n,r){return G.apply(this,arguments)}function G(){return(G=Object(m.a)(S.a.mark((function e(t,n,r,a){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.requestAsyncGATTWrite(n,w.WriteToMMR,_(r,a),!0);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e){return new Promise((function(t){return setTimeout(t,e)}))}function K(e,t,n){return J.apply(this,arguments)}function J(){return(J=Object(m.a)(S.a.mark((function e(t,n,r){var a,s,o,c,i,u;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N=null,e.next=3,t.requestAsyncGATTSetNotify(n,w.FWMapRequest,!0,W);case 3:if((s=e.sent).success){e.next=6;break}return e.abrupt("return",s);case 6:return e.next=8,P(t,n,0,1,1,0);case 8:if((o=e.sent).success){e.next=11;break}return e.abrupt("return",o);case 11:return c=0,e.next=14,U(t,n);case 14:a=e.sent;case 15:if(!(c<10)||a.success){e.next=24;break}return e.next=18,V(1e3);case 18:return c+=1,e.next=21,U(t,n);case 21:a=e.sent,e.next=15;break;case 24:console.log("Erased"),c=0,i=r.slice(c,c+16);case 27:if(!(i.byteLength>0)){e.next=39;break}return e.next=30,H(t,n,i,c);case 30:if((u=e.sent).success){e.next=34;break}return console.log("Something went wrong during firmware upload. GATT MMR write reported: "+u.error),e.abrupt("return",u);case 34:console.log("Wrote %d bytes to %08x",i.byteLength,c),c+=i.byteLength,i=r.slice(c,c+16),e.next=27;break;case 39:return e.abrupt("return",{success:!0});case 40:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e,t){return X.apply(this,arguments)}function X(){return X=Object(m.a)(S.a.mark((function e(t,n){var r,a,s,o,c,i=arguments;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]&&i[2],a=r?16777214:16777215,N=null,e.next=5,P(t,n,0,0,1,a);case 5:if((s=e.sent).success){e.next=8;break}return e.abrupt("return",s);case 8:return e.next=10,U(t,n);case 10:o=e.sent,c=0;case 12:if(!(c<10)||o.success){e.next=22;break}return console.log("%4d Waiting for check error response...",c),e.next=16,V(1e3);case 16:return e.next=18,U(t,n);case 18:o=e.sent,c+=1,e.next=12;break;case 22:if(!o.success){e.next=24;break}return e.abrupt("return",{success:!0,result:o.result.FirstError});case 24:return e.abrupt("return",{success:!1});case 25:case"end":return e.stop()}}),e)}))),X.apply(this,arguments)}function Q(e,t,n){return Z.apply(this,arguments)}function Z(){return(Z=Object(m.a)(S.a.mark((function e(t,n,r){var a,s;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K(t,n,r);case 2:if(a=e.sent){e.next=5;break}return e.abrupt("return",a);case 5:return e.next=7,z(t,n,!1);case 7:if((s=e.sent).success){e.next=10;break}return e.abrupt("return",{success:!1,error:{eid:1,errmsg:"Timed out during FWMapRequest polling"}});case 10:if(16777213==s.result){e.next=30;break}return console.log("Error reported at offset: %08X",s.result),e.next=14,z(t,n,!0);case 14:if((s=e.sent).success){e.next=17;break}return e.abrupt("return",{success:!1,error:{eid:1,errmsg:"Timed out during FWMapRequest polling"}});case 17:return console.log("Next error at: %08X",s.result),e.next=20,z(t,n,!0);case 20:if((s=e.sent).success){e.next=23;break}return e.abrupt("return",{success:!1,error:{eid:1,errmsg:"Timed out during FWMapRequest polling"}});case 23:return console.log("Next error at: %08X",s.result),e.next=26,z(t,n,!0);case 26:if((s=e.sent).success){e.next=29;break}return e.abrupt("return",{success:!1,error:{eid:1,errmsg:"Timed out during FWMapRequest polling"}});case 29:console.log("Next error at: %08X",s.result);case 30:return e.abrupt("return",{success:!0});case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Y=n(200),$=n(197),ee=n(1);var te=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).fileSelector=void 0,r.handleFileSelect=function(e){e.preventDefault(),r.fileSelector&&r.fileSelector.click()},r.selectionChanged=function(e){var t;console.log("selectionChanged event: "+e),null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.files&&(r.state.onchange(e.target.files),r.setState({files:e.target.files}))},r.state={files:null,onchange:e.onchange},r}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.fileSelector=function(){var e=document.createElement("input");return e.setAttribute("type","file"),e}(),this.fileSelector.addEventListener("change",this.selectionChanged)}},{key:"render",value:function(){return Object(ee.jsx)("div",{children:Object(ee.jsx)($.a,{variant:"contained",onClick:this.handleFileSelect,children:"Select file"})})}}]),n}(g.a.Component),ne=n(39),re=n(214),ae=n(199);function se(e){return Object(ee.jsxs)(ae.a,{sx:{display:"flex",alignItems:"center"},children:[Object(ee.jsx)(ae.a,{sx:{width:"100%",mr:1},children:Object(ee.jsx)(re.a,Object(ne.a)({variant:"determinate"},e))}),Object(ee.jsx)(ae.a,{sx:{minWidth:35},children:Object(ee.jsx)(Y.a,{variant:"body2",color:"text.secondary",children:"".concat(Math.round(e.value),"%")})})]})}var oe=function(e){return Object(ee.jsx)(Y.a,{component:"h2",variant:"h6",color:"primary",gutterBottom:!0,children:e.children})},ce=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).setFileList=function(e){M.c.getInstance().updateKey("Updater","firmwarefile",e),ie.getInstance().sendEventToSM({type:"EV_FirmwareSelected"})},r.state={step:"WaitForFile",mac:e.mac,name:e.name,progress:0},r}return Object(h.a)(n,[{key:"showState",value:function(){switch(this.state.step){case"WaitForFile":return"Please select a file to upload.";case"Uploading":return"Firmware update in progress. Please do not disturb the DE1.";case"Done":return"Firmware update complete."}}},{key:"render",value:function(){return Object(ee.jsxs)(g.a.Fragment,{children:[Object(ee.jsx)(oe,{children:"Update Firmware"}),Object(ee.jsx)(Y.a,{component:"h4",color:"primary",children:this.showState()}),Object(ee.jsx)(se,{value:0}),Object(ee.jsx)(te,{onchange:this.setFileList})]})}}]),n}(g.a.Component);var ie=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(){var e;return Object(d.a)(this,n),(e=t.call(this,"Init")).dashcontroller=new j,e.MM=new k.a,e.CurrentConnection=null,e.DebugLogList=[],e._updateReadyStatus=function(t){t?e.sendEventToSM({type:"EV_WSReady"}):e.sendEventToSM({type:"EV_Disconnected"})},e.A_StartBLEScan=function(){console.log("AppMachine: A_StartBLEScan");n.BLE0.requestScanWithCallbacks(3,(function(t,n){t&&e.sendEventToSM({type:"EV_ScanDone"})}))},e.A_ShowMenu=function(){},e.A_HideMenu=function(){},e.A_ShowBLEScan=function(){e.dashcontroller.setActiveDrawer("Devices")},e.A_HideBLEScan=function(){},e.A_DoFirmwareUpdate=Object(m.a)(S.a.mark((function t(){var r,a,s;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=M.b.getInstance().readKey("Updater","firmwarefile"))&&e.CurrentConnection){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,r[0].arrayBuffer();case 5:return a=t.sent,console.log("this.CurrentConnection:",e.CurrentConnection),t.next=9,Q(n.BLE0,e.CurrentConnection.mac,a);case 9:(s=t.sent).success?console.log("Firmware upload succeeded"):console.log("Firmware upload failed: ",s.error);case 11:case"end":return t.stop()}}),t)}))),e.wait=function(e){return new Promise((function(t,n){return setTimeout(t,e)}))},e.A_ReadLog=Object(m.a)(S.a.mark((function t(){var a,s,o,c,i,u,l;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.CurrentConnection){t.next=2;break}return t.abrupt("return");case 2:return a=e.CurrentConnection.mac,t.next=5,n.BLE0.setUpForMMRReads(a);case 5:if(t.sent.success){t.next=9;break}return console.log("A_ReadLog: Cound not enable MMR reads"),t.abrupt("return");case 9:return console.log("Starting debug log read"),t.next=12,n.BLE0.requestAsyncMMRRead(a,r.DebugLen,0);case 12:if(s=t.sent,console.log("A_ReadLog: ",s),o=e._readLEUInt32(s.payload,0),console.log("A_ReadLog: Log length is",o),!(o>4096)){t.next=18;break}throw new Error("Loglen of ".concat(o," is out of range"));case 18:if(0!==o){t.next=20;break}return t.abrupt("return");case 20:c=new Uint8Array(o),i=0;case 22:if(!(i<o)){t.next=38;break}return console.log("A_ReadLog: Reading at offset ".concat(i," out of ").concat(o)),t.prev=24,t.next=27,n.BLE0.requestAsyncMMRRead(a,r.DebugBuffer+i,3);case 27:u=t.sent,c.set(Array.from(u.payload),i),M.b.getInstance().updateKey("AppController","debuglogprogress",100*i/o),t.next=35;break;case 32:t.prev=32,t.t0=t.catch(24),console.log(t.t0);case 35:i+=16,t.next=22;break;case 38:return t.next=40,n.BLE0.requestAsyncMMRRead(a,r.DebugConfig,0);case 40:l="",l+=String.fromCharCode.apply(String,Object(v.a)(c)),M.b.getInstance().updateKey("AppController","debuglog",l),e.DebugLogList.push({name:(new Date).toJSON(),log:l}),M.b.getInstance().updateKey("AppController","debugloglist",e.DebugLogList,!0),console.log("Debug log: ",l);case 46:case"end":return t.stop()}}),t,null,[[24,32]])}))),e.A_SendDisconnect=function(){},e.requestConnect=function(t,r){n.BLE0.requestGATTConnect(r,(function(n,a){return"CONNECTED"===a.CState&&(e.CurrentConnection={name:t,mac:r},e.sendEventToSM({type:"EV_Connected"})),"CANCELLED"!==a.CState&&"DISCONNECTED"!==a.CState||(e.CurrentConnection=null,e.sendEventToSM({type:"EV_Disconnected"})),!1}))},e.S_Init=function(){var t=Object(m.a)(S.a.mark((function t(r){return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.BLE0.registerForReadyUpdates(e._updateReadyStatus),n.getInstance().dashcontroller.setActiveDrawer("Devices"),t.abrupt("return","ConnectWSC");case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.S_ConnectWSC=function(){var t=Object(m.a)(S.a.mark((function t(r){var a,s;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r){t.next=3;break}if(n.BLE0.WSC.getReadyState()!=WebSocket.OPEN){t.next=3;break}return t.abrupt("return","StartBLEScan");case 3:if(a=null,!(s=e.getEvent())){t.next=16;break}t.t0=s.type,t.next="EV_WSReady"===t.t0?9:"EV_Disconnected"===t.t0?11:13;break;case 9:return a="StartBLEScan",t.abrupt("break",16);case 11:return a="Init",t.abrupt("break",16);case 13:return console.log("Unexpected event in S_ConnectWSC: ",s),a="Init",t.abrupt("break",16);case 16:return t.abrupt("return",a);case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.S_StartBLEScan=function(){var t=Object(m.a)(S.a.mark((function t(r){var a,s;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r){t.next=5;break}return e.dashcontroller.setActiveDrawer("Devices"),e.A_StartBLEScan(),n.getInstance().dashcontroller.setItemVisible("Devices","Devices",!0),t.abrupt("return",null);case 5:if(a=null,!(s=e.getEvent())){t.next=17;break}t.t0=s.type,t.next="EV_ScanDone"===t.t0?11:"EV_Disconnected"===t.t0?13:15;break;case 11:return a="SelectDE1",t.abrupt("break",17);case 13:return a="Init",t.abrupt("break",17);case 15:return console.log("Unexpected event in S_StartBLEScan: ",s),t.abrupt("break",17);case 17:return t.abrupt("return",a);case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.S_SelectDE1=function(){var t=Object(m.a)(S.a.mark((function t(n){var r,a;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=null,!(a=e.getEvent())){t.next=14;break}t.t0=a.type,t.next="EV_Connected"===t.t0?6:"EV_ReqScan"===t.t0?8:"EV_Disconnected"===t.t0?10:12;break;case 6:return r="ShowMenu",t.abrupt("break",14);case 8:return r="StartBLEScan",t.abrupt("break",14);case 10:return r="Init",t.abrupt("break",14);case 12:return console.log("Unexpected event in S_SelectDE1: ",a),t.abrupt("break",14);case 14:return t.abrupt("return",r);case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.S_ShowMenu=function(){var t=Object(m.a)(S.a.mark((function t(r){var a,s;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r&&(n.getInstance().dashcontroller.setItemVisible("UserMenu","Devices",!0),n.getInstance().dashcontroller.setItemVisible("Devices","Devices",!1)),a=null,!(s=e.getEvent())){t.next=16;break}t.t0=s.type,t.next="EV_ReadLog"===t.t0?7:"EV_SelectFirmware"===t.t0?9:"EV_ReqDisconnect"===t.t0?11:"EV_Disconnected"===t.t0?13:15;break;case 7:return a="ReadLog",t.abrupt("break",16);case 9:return a="DoFirmwareSelect",t.abrupt("break",16);case 11:return a="Disconnect",t.abrupt("break",16);case 13:return a="Init",t.abrupt("break",16);case 15:return t.abrupt("break",16);case 16:return null!==a&&n.getInstance().dashcontroller.setItemVisible("UserMenu","Devices",!1),t.abrupt("return",a);case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.S_ReadLog=function(){var t=Object(m.a)(S.a.mark((function t(r){var a,s;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r){t.next=4;break}return n.getInstance().dashcontroller.setItemVisible("DE1Info","Devices",!0),t.next=4,e.A_ReadLog();case 4:if(a=null,!(s=e.getEvent())){t.next=13;break}t.t0=s.type,t.next="EV_Disconnected"===t.t0?10:12;break;case 10:return a="Init",t.abrupt("break",13);case 12:return t.abrupt("break",13);case 13:return t.abrupt("return",a);case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.S_DoFirmwareSelect=function(){var t=Object(m.a)(S.a.mark((function t(r){var a,s,o;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r&&(a=n.getInstance().dashcontroller,e.CurrentConnection&&(a.addItem("Updater","Firmware",Object(ee.jsx)(ce,{mac:e.CurrentConnection.mac,name:e.CurrentConnection.name}),!0),a.setActiveDrawer("Firmware"))),s=null,!(o=e.getEvent())){t.next=12;break}t.t0=o.type,t.next="EV_Disconnected"===t.t0?7:"EV_FirmwareSelected"===t.t0?9:11;break;case 7:return s="Init",t.abrupt("break",12);case 9:return s="DoFirmwareUpdate",t.abrupt("break",12);case 11:return t.abrupt("break",12);case 12:return t.abrupt("return",s);case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.S_DoFirmwareUpdate=function(){var t=Object(m.a)(S.a.mark((function t(n){var r,a;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=3;break}return t.next=3,e.A_DoFirmwareUpdate();case 3:if(r=null,!(a=e.getEvent())){t.next=12;break}t.t0=a.type,t.next="EV_Disconnected"===t.t0?9:11;break;case 9:return r="Init",t.abrupt("break",12);case 11:return t.abrupt("break",12);case 12:return t.abrupt("return",r);case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.S_Disconnect=function(){var t=Object(m.a)(S.a.mark((function t(r){var a,s,o;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r&&(console.log("AppMachine S_Disconnect() requesting disconnect from ",e.CurrentConnection),e.CurrentConnection&&(a=function(t,n){return console.log("S_Disconnect: Disconnect: ",n),e.sendEventToSM({type:"EV_Disconnected"}),!1},n.BLE0.requestGATTDisconnect(e.CurrentConnection.mac,a))),s=null,!(o=e.getEvent())){t.next=10;break}t.t0=o.type,t.next="EV_Disconnected"===t.t0?7:9;break;case 7:return s="Init",t.abrupt("break",10);case 9:return t.abrupt("break",10);case 10:return t.abrupt("return",s);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.S_Error=function(){var e=Object(m.a)(S.a.mark((function e(t){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.StateMap=new Map([["Init",e.S_Init],["ConnectWSC",e.S_ConnectWSC],["StartBLEScan",e.S_StartBLEScan],["SelectDE1",e.S_SelectDE1],["ShowMenu",e.S_ShowMenu],["ReadLog",e.S_ReadLog],["DoFirmwareSelect",e.S_DoFirmwareSelect],["DoFirmwareUpdate",e.S_DoFirmwareUpdate],["Disconnect",e.S_Disconnect],["Error",e.S_Error]]),e.onTransition=function(){console.log("AppMachine state transition: ".concat(e.LastState," -> ").concat(e.CurrentState)),M.b.getInstance().updateKey("AppController","AppMachineState",e.CurrentState)},e._wschange=function(t,n,r,a,s){var o=s;o===WebSocket.OPEN&&e.sendEventToSM({type:"EV_WSReady"}),o===WebSocket.CLOSED&&e.sendEventToSM({type:"EV_Disconnected"})},e.run=Object(m.a)(S.a.mark((function t(){return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.evalSM();case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),console.log("Exception in AppMachine.run(): ",t.t0);case 8:setTimeout(e.run,10);case 9:case"end":return t.stop()}}),t,null,[[0,5]])}))),e.setStateCode(e.StateMap),M.b.getInstance().updateKey("AppController","AppMachineState",e.CurrentState),e}return Object(h.a)(n,[{key:"_readLEUInt32",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Uint8Array.from(e).buffer,r=new DataView(n,t);return r.getUint32(0,!0)}}],[{key:"getInstance",value:function(){return n.instance}}]),n}(function(){function e(t){var n=this;Object(d.a)(this,e),this.CurrentState=void 0,this.LastState=void 0,this.EventQ=[],this.Transition=!1,this.StateCode=new Map,this.sendEventToSM=function(e){console.log("sendEventToSM: Adding event ",e),n.EventQ.push(e)},this.getEvent=function(){return n.EventQ.shift()},this.onTransition=function(){},this._needToEvalSM=function(){return n.Transition||n.EventQ.length>0},this.evalSM=Object(m.a)(S.a.mark((function e(){var t,r;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.Transition&&n.onTransition(),void 0!==(t=n.StateCode.get(n.CurrentState))){e.next=7;break}throw console.log("evalSM: No function for the current state ".concat(n.CurrentState)),new Error("evalSM: No function for the current state ".concat(n.CurrentState));case 7:return e.next=9,t(n.Transition);case 9:null!==(r=e.sent)?(n.LastState=n.CurrentState,n.CurrentState=r,n.Transition=!0):n.Transition=!1;case 11:if(n._needToEvalSM()){e.next=0;break}case 12:case"end":return e.stop()}}),e)}))),this.CurrentState=t,this.LastState=t,this.Transition=!0}return Object(h.a)(e,[{key:"setStateCode",value:function(e){this.StateCode=e}}]),e}());ie.instance=ie.instance||new ie,ie.BLE0=new C.a("BLE0","ws://192.168.68.67:8765");var ue=n(204),le=n(207),de=n(206),he=n(205),fe=n(208),pe=n(196),be=n(201),ge=n(97),ve=n.n(ge),me=n(98),ye=n.n(me),Se=n(8),Ce=n(192),ke=n(215),je=n(4),Me=Object(je.a)(ke.a,{shouldForwardProp:function(e){return"open"!==e}})((function(e){var t=e.theme,n=e.open;return Object(ne.a)({zIndex:t.zIndex.drawer+1,transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen})},n&&{marginLeft:240,width:"calc(100% - ".concat(240,"px)"),transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.enteringScreen})})})),we=Object(je.a)(Ce.a,{shouldForwardProp:function(e){return"open"!==e}})((function(e){var t=e.theme,n=e.open;return{"& .MuiDrawer-paper":Object(ne.a)({position:"relative",whiteSpace:"nowrap",width:240,transition:t.transitions.create("width",{easing:t.transitions.easing.sharp,duration:t.transitions.duration.enteringScreen}),boxSizing:"border-box"},!n&&Object(Se.a)({overflowX:"hidden",transition:t.transitions.create("width",{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen}),width:t.spacing(7)},t.breakpoints.up("sm"),{width:t.spacing(9)}))}})),Oe=n(194),xe=n(202),Re=n(203),De=n(185),Ee=n(216),Te=n(183),Ae=n(182);function _e(e){return Object(ee.jsxs)(Ae.a,{onClick:function(){!function(e,t){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}(e.name+".txt",e.log)},children:[Object(ee.jsx)(xe.a,{children:Object(ee.jsx)(Te.a,{})}),Object(ee.jsx)(Re.a,{primaryTypographyProps:{fontSize:"x-small"},primary:e.name})]})}var Ie=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).state=void 0,r.componentDidMount=function(){M.c.getInstance().requestNotifyOnChanged("AppController","debugloglist",r._logsupdated)},r.componentWillUnmount=function(){M.c.getInstance().cancelNotify("AppController","debugloglist",r._logsupdated)},r._logsupdated=function(e,t,n,a,s){r.setState({items:s})},r.render=function(){return Object(ee.jsxs)("div",{children:[r.state.items.length>0&&Object(ee.jsx)(Ee.a,{inset:!0,children:r.state.header}),r.state.items.map(_e)]})},r.state={header:e.header,items:[]},r}return Object(h.a)(n)}(g.a.Component),Le=Object(u.a)();function Fe(e){return Object(ee.jsx)(be.a,{sx:{p:2,display:"flex",flexDirection:"column"},children:e})}function Ne(e,t){return console.log("wrapInGridCell: ",e),Object(ee.jsx)(pe.a,{item:!0,xs:12,children:t},e)}var We=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).toggleDrawer=function(){r.setState({open:!r.state.open})},r.makeListItem=function(e){return console.log("MakeListItem: ",e.name),Object(ee.jsxs)(Oe.a,{button:!0,onClick:function(){r.onDrawerClick(e.name)},children:[Object(ee.jsx)(xe.a,{children:e.draweritem}),Object(ee.jsx)(Re.a,{primary:e.name})]},e.name)},r.state={open:!0,changecount:0},r}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.props.controller.setUIElement(this)}},{key:"dcontent",value:function(){console.log("dcontent() state: ",this);var e=this.props.controller.getCurrentDrawer(),t=this.props.controller.drawers.find((function(t){return console.log("Compare: ",t.name,e,t.name===e),t.name===e}));return void 0!==t?t.contents.map((function(e){return e.visible?Ne(e.name,Fe(e.item)):null})):Ne("Oops",Fe(Object(ee.jsx)("p",{children:"Oops. Nothing to show."})))}},{key:"drawerContent",value:function(){return Object(ee.jsx)(b.Fragment,{children:this.dcontent()})}},{key:"onDrawerClick",value:function(e){this.props.controller.setActiveDrawer(e)}},{key:"mainListItems",value:function(){var e=Array.from(this.props.controller.drawers);return Object(ee.jsx)("div",{children:e.map(this.makeListItem)})}},{key:"render",value:function(){return Object(ee.jsx)(c.a,{theme:Le,children:Object(ee.jsxs)(ae.a,{sx:{display:"flex"},children:[Object(ee.jsx)(o.a,{}),Object(ee.jsx)(Me,{position:"absolute",open:this.state.open,children:Object(ee.jsxs)(ue.a,{sx:{pr:"24px"},children:[Object(ee.jsx)(he.a,{edge:"start",color:"inherit","aria-label":"open drawer",onClick:this.toggleDrawer,sx:Object(ne.a)({marginRight:"36px"},this.state.open&&{display:"none"}),children:Object(ee.jsx)(ve.a,{})}),Object(ee.jsx)(Y.a,{component:"h1",variant:"h6",color:"inherit",noWrap:!0,sx:{flexGrow:1},children:this.props.controller.getCurrentDrawer()})]})}),Object(ee.jsxs)(we,{variant:"permanent",open:this.state.open,children:[Object(ee.jsx)(ue.a,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",px:[1]},children:Object(ee.jsx)(he.a,{onClick:this.toggleDrawer,children:Object(ee.jsx)(ye.a,{})})}),Object(ee.jsx)(de.a,{}),Object(ee.jsx)(le.a,{children:this.mainListItems()}),Object(ee.jsx)(de.a,{}),Object(ee.jsx)(le.a,{children:Object(ee.jsx)(Ie,{header:"Recent Debug Logs"})})]}),Object(ee.jsxs)(ae.a,{component:"main",sx:{backgroundColor:function(e){return"light"===e.palette.mode?e.palette.grey[100]:e.palette.grey[900]},flexGrow:1,height:"100vh",overflow:"auto"},children:[Object(ee.jsx)(ue.a,{}),Object(ee.jsxs)(fe.a,{maxWidth:"lg",sx:{mt:4,mb:4},children:[Object(ee.jsx)(pe.a,{container:!0,spacing:3,children:this.drawerContent()}),Object(ee.jsx)(De.a,{sx:{pt:4}})]})]})]})})}}]),n}(b.Component),Ue=n(99),qe=n.n(Ue),Pe=n(100),Be=n.n(Pe),He=n(82),Ge=n(210),Ve=n(213),Ke=n(209),Je=n(211),ze=n(212),Xe=n(186),Qe=n(187),Ze=n(188),Ye=n(190),$e=n(217),et=n(189);n(133);function tt(e,t){return e.addr===t.addr?0:e.addr>t.addr?-1:1}var nt=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).state=void 0,r.onStateChange=function(e,t,n,a,s){console.log("onStateChange:",e,t,n,a,s),"SelectDE1"===s?r.setState({allowConnect:!0,connecting:!1}):r.setState({allowConnect:!1,connecting:!1})},r.onDeviceChange=function(e,t,n,a,s){if(console.log("onDeviceChange:",e,t,n,a,s),n===M.a.Changed||n===M.a.Added){var o,c=[],i=Object(He.a)(s.keys());try{for(i.s();!(o=i.n()).done;){var u=o.value,l=s.get(u);l&&c.push(r.createData(l.MAC,l.Name,l.State))}}catch(d){i.e(d)}finally{i.f()}c.sort(tt),r.setState({rows:c})}},console.log("Devices()"),console.log("props:",e),r.state={rows:[r.createData("","","DISCONNECTED")],allowConnect:!1,connecting:!1},console.log("this.state:",r.state),r}return Object(h.a)(n,[{key:"componentDidMount",value:function(){M.c.getInstance().requestNotifyOnChanged(this.props.name,"DeviceSet",this.onDeviceChange),M.c.getInstance().requestNotifyOnChanged("AppController","AppMachineState",this.onStateChange),this.setState({rows:this.rowsFromStore(),allowConnect:!1,connecting:!1})}},{key:"componentWillUnmount",value:function(){M.c.getInstance().cancelNotify(this.props.name,"DeviceSet",this.onDeviceChange),M.c.getInstance().cancelNotify("AppController","AppMachineState",this.onStateChange)}},{key:"rowsFromStore",value:function(){var e=[],t=M.c.getInstance().readKey(this.props.name,"DeviceSet");if(void 0!==t){var n,r=Object(He.a)(t.keys());try{for(r.s();!(n=r.n()).done;){var a=n.value,s=t.get(a);s&&e.push(this.createData(s.MAC,s.Name,s.State))}}catch(o){r.e(o)}finally{r.f()}e.sort(tt)}else e.push(this.createData("-","-","DISCONNECTED"));return e}},{key:"addDevice",value:function(e,t,n){this.state.rows.push(this.createData(e,t,n))}},{key:"createData",value:function(e,t,n){return{addr:e,name:t,cstate:n}}},{key:"preventDefault",value:function(e){e.preventDefault()}},{key:"disconnect",value:function(e,t){console.log("Device onClick() disconnect from ",e,t);ie.BLE0.requestGATTDisconnect(t,(function(e,t){return console.log("Devices: Disconnect: ",t),!1}))}},{key:"connect",value:function(e,t){console.log("Device onClick() connect to ",e,t),ie.getInstance().requestConnect(e,t),this.setState({connecting:!0})}},{key:"connectIcon",value:function(e){var t=this,n={width:"24px",height:"24px",margin:"5px"};return"DE1"===e.name?"CONNECTED"!==e.cstate?this.state.allowConnect&&!this.state.connecting?Object(ee.jsx)(Ke.a,{children:Object(ee.jsx)("div",{className:"cell-button",children:Object(ee.jsx)(he.a,{onClick:function(){t.connect(e.name,e.addr)},children:Object(ee.jsx)(Xe.a,{})})})}):Object(ee.jsx)(Ke.a,{children:Object(ee.jsx)("div",{className:"cell-button",children:Object(ee.jsx)($e.a,{style:n})})}):Object(ee.jsx)(Ke.a,{children:Object(ee.jsx)("div",{className:"cell-button",children:Object(ee.jsx)(he.a,{onClick:function(){t.disconnect(e.name,e.addr)},style:n,children:Object(ee.jsx)(Qe.a,{})})})}):Object(ee.jsx)(Ke.a,{children:Object(ee.jsx)("div",{className:"cell-button",children:Object(ee.jsx)(he.a,{style:n,children:Object(ee.jsx)(Ze.a,{})})})})}},{key:"reqScan",value:function(){ie.getInstance().sendEventToSM({type:"EV_ReqScan"})}},{key:"render",value:function(){var e,t=this;return e=this.state.allowConnect?Object(ee.jsx)(et.a,{sx:{pt:2},direction:"row",className:"scan-box",children:Object(ee.jsx)($.a,{variant:"contained",size:"medium",startIcon:Object(ee.jsx)(Ye.a,{}),onClick:this.reqScan,children:"Scan"})}):Object(ee.jsx)(et.a,{sx:{pt:2},direction:"row",className:"scan-box",children:Object(ee.jsx)($.a,{disabled:!0,variant:"contained",size:"medium",startIcon:Object(ee.jsx)(Ye.a,{}),onClick:this.reqScan,children:"Scan"})}),Object(ee.jsxs)("div",{className:"device-card",children:[Object(ee.jsx)(oe,{children:"Seen Devices"}),Object(ee.jsxs)(Ge.a,{size:"small",children:[Object(ee.jsx)(Je.a,{children:Object(ee.jsxs)(ze.a,{children:[Object(ee.jsx)(Ke.a,{children:"BLE Name"}),Object(ee.jsx)(Ke.a,{children:"BLE Address"}),Object(ee.jsx)(Ke.a,{children:"Connect"})]})}),Object(ee.jsx)(Ve.a,{children:this.state.rows.map((function(e){return Object(ee.jsxs)(ze.a,{children:[Object(ee.jsx)(Ke.a,{children:e.name}),Object(ee.jsx)(Ke.a,{children:e.addr}),t.connectIcon(e)]},e.addr)}))})]}),e]})}}]),n}(b.Component),rt=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).onControllerChange=function(e,t,n,a,s){console.log("onControllerChange:",e,t,n,a,s),r.updateStateFromStore()},console.log("Props:",e),r.state={url:"Unset",readyState:3},r}return Object(h.a)(n,[{key:"componentDidMount",value:function(){M.c.getInstance().requestNotifyOnChanged(this.props.name,"url",this.onControllerChange),M.c.getInstance().requestNotifyOnChanged(this.props.name,"readyState",this.onControllerChange),this.updateStateFromStore()}},{key:"componentWillUnmount",value:function(){console.log("WSClient.componentWillUnmount"),M.c.getInstance().cancelNotify(this.props.name,"url",this.onControllerChange),M.c.getInstance().cancelNotify(this.props.name,"readyState",this.onControllerChange)}},{key:"updateStateFromStore",value:function(){this.setState({url:M.c.getInstance().readKey(this.props.name,"url"),readyState:M.c.getInstance().readKey(this.props.name,"readyState")})}},{key:"render",value:function(){return Object(ee.jsxs)(g.a.Fragment,{children:[Object(ee.jsx)(oe,{children:"WebSocket Connection"}),Object(ee.jsxs)("ul",{children:[Object(ee.jsxs)("li",{children:[" URL: ",this.state.url," "]}),Object(ee.jsxs)("li",{children:[" Status: ",1===this.state.readyState?"Connected":"Disconnected"]})]})]})}}]),n}(b.Component),at=n(191),st=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r,a;return Object(d.a)(this,n),(a=t.call(this,e)).LogLines=[],a.updateLog=function(){var e=M.c.getInstance().readKey("AppController","debuglog");e&&(a.LogLines=e.split("\n"))},a._updateProgress=function(e,t,n,r,s){var o=s;a.setState({progress:o})},a._updateLog=function(e,t,n,r,s){a.updateLog(),a.setState({updatecount:a.state.updatecount+1})},a.state={cstate:(null===(r=ie.BLE0.SeenDevices.get(e.mac))||void 0===r?void 0:r.State)||"DISCONNECTED",progress:0,updatecount:0},a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){M.c.getInstance().requestNotifyOnChanged("AppController","debuglog",this._updateLog),M.c.getInstance().requestNotifyOnChanged("AppController","debuglogprogress",this._updateProgress)}},{key:"componentWillUnmount",value:function(){M.c.getInstance().cancelNotify("AppController","debuglog",this._updateLog),M.c.getInstance().cancelNotify("AppController","debuglogprogress",this._updateProgress)}},{key:"render",value:function(){return this.updateLog(),Object(ee.jsxs)("div",{className:"de1info-card",children:[Object(ee.jsx)(oe,{children:"Debug log"}),0==this.LogLines.length&&Object(ee.jsx)(se,{value:this.state.progress}),Object(ee.jsx)("p",{className:"debuglog",style:{fontFamily:"monospace",fontSize:"x-small"},children:this.LogLines.map((function(e){return Object(ee.jsxs)(b.Fragment,{children:[e," ",Object(ee.jsx)("br",{})]})}))})]})}}]),n}(b.Component),ot=(n(134),function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).state=void 0,r.makeOnclick=function(e){return function(){switch(e){case 0:ie.getInstance().sendEventToSM({type:"EV_ReadLog"});break;case 1:ie.getInstance().sendEventToSM({type:"EV_SelectFirmware"});break;case 2:ie.getInstance().sendEventToSM({type:"EV_ReqDisconnect"})}}},r.state={},console.log("UserMenu constructor state:",r.state),r}return Object(h.a)(n,[{key:"render",value:function(){return Object(ee.jsxs)(et.a,{className:"user-menu",sx:{spacing:1},children:[Object(ee.jsx)($.a,{variant:"contained",onClick:this.makeOnclick(0),children:"Read Debug Log"}),Object(ee.jsx)($.a,{variant:"contained",onClick:this.makeOnclick(1),children:"Update Firmware"}),Object(ee.jsx)($.a,{variant:"contained",onClick:this.makeOnclick(2),children:"Disconnect"})]})}}]),n}(b.Component)),ct=[["Firmware",Object(ee.jsx)(at.a,{}),[["WSClient",Object(ee.jsx)(rt,{name:"wsc_BLE0"}),!0]]],["Status",Object(ee.jsx)(qe.a,{}),[["WSClient",Object(ee.jsx)(rt,{name:"wsc_BLE0"}),!0]]],["Devices",Object(ee.jsx)(Be.a,{}),[["UserMenu",Object(ee.jsx)(ot,{}),!1],["DE1Info",Object(ee.jsx)(st,{mac:""}),!1],["Devices",Object(ee.jsx)(nt,{name:"BLE0"}),!0],["WSClient",Object(ee.jsx)(rt,{name:"wsc_BLE0"}),!0]]]],it=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(d.a)(this,n),r=t.call(this,e),console.log("props: ",e),r}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=this;console.log("cdm: ",this),ct.forEach((function(t){ie.getInstance().dashcontroller.addDrawer(t[0],t[1],e.toDrawerContentType(t[2]))})),ie.getInstance().dashcontroller.setActiveDrawer("Devices")}},{key:"toDrawerContentType",value:function(e){return e.map((function(e){return{name:e[0],item:e[1],visible:e[2]}}))}},{key:"render",value:function(){return Object(ee.jsx)(We,{controller:ie.getInstance().dashcontroller})}}]),n}(g.a.Component);s.a.render(Object(ee.jsxs)(c.a,{theme:l,children:[Object(ee.jsx)(o.a,{}),Object(ee.jsx)(it,{})]}),document.querySelector("#root")),ie.getInstance().run()},14:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));var r,a=n(15),s=n(16);!function(e){e[e.Added=0]="Added",e[e.Changed=1]="Changed",e[e.Deleted=2]="Deleted"}(r||(r={}));var o=function(){function e(){Object(a.a)(this,e),this.globalkeystore=new Map,this.notifybykey=new Map,console.log("******************** KeyStore constructor()")}return Object(s.a)(e,[{key:"_getStore",value:function(e){var t=this.globalkeystore.get(e);return t||(t=new Map,this.globalkeystore.set(e,t)),t}},{key:"_doNotifyAdded",value:function(e,t,n){var a=this.notifybykey.get(e);if(void 0!==a){var s=a.get(t);s&&s.forEach((function(a){a(e,t,r.Added,null,n)}))}}},{key:"_doNotifyDeleted",value:function(e,t,n){var a=this.notifybykey.get(e);if(void 0!==a){var s=a.get(t);s&&(s.forEach((function(a){a(e,t,r.Deleted,n,null)})),a.delete(t))}}},{key:"_doNotifyChanged",value:function(e,t,n,a){var s=this.notifybykey.get(e);if(void 0!==s){var o=s.get(t);o&&o.forEach((function(s){s(e,t,r.Changed,n,a)}))}}},{key:"updateKey",value:function(e,t,n,r){console.log("updateKey:",e,t,n,r);var a=this._getStore(e),s=a.get(t);(r||s!==n)&&(a.set(t,n),this._doNotifyChanged(e,t,s,n))}},{key:"readKey",value:function(e,t){return this._getStore(e).get(t)}},{key:"delKey",value:function(e,t){var n=this._getStore(e);if(n.has(t)){var r=n.get(t);this._doNotifyDeleted(e,t,r),n.delete(t)}}},{key:"delOwnerKeys",value:function(e){for(var t=this._getStore(e),n=0,r=Array.from(t.keys());n<r.length;n++){var a=r[n];this.delKey(e,a)}}},{key:"requestNotifyOnChanged",value:function(e,t,n){if(console.log("requestNotifyOnChanged:",e,t),!e)throw Error("Ownername invalid");if(!t)throw Error("Key invalid");var r=this.notifybykey.get(e);r||(r=new Map,this.notifybykey.set(e,r));var a=r.get(t);a||(a=new Set([]),r.set(t,a)),a.add(n)}},{key:"cancelNotify",value:function(e,t,n){var r=this.notifybykey.get(e);if(void 0!==r){var a=r.get(t);a&&a.delete(n)}}}],[{key:"getInstance",value:function(){return e.instance}}]),e}();o.instance=o.instance||new o,t.c=o},47:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(17),a=n(15),s=n(16),o=function(){function e(){Object(a.a)(this,e),this.map=new Map,this.keyMap=new Map}return Object(s.a)(e,[{key:"has",value:function(e){var t=this.stringifyKey(e);return this.map.has(t)}},{key:"get",value:function(e){var t=this.stringifyKey(e);return this.map.get(t)}},{key:"set",value:function(e,t){var n=this.stringifyKey(e);return this.map.set(n,t),this.keyMap.set(n,e),this}},{key:"putIfAbsent",value:function(e,t){if(!this.has(e)){var n=t();return this.set(e,n),!0}return!1}},{key:"keys",value:function(){return this.keyMap.values()}},{key:"keyList",value:function(){return Object(r.a)(this.keys())}},{key:"delete",value:function(e){var t=this.stringifyKey(e),n=this.map.delete(t);return this.keyMap.delete(t),n}},{key:"clear",value:function(){this.map.clear(),this.keyMap.clear()}},{key:"size",value:function(){return this.map.size}}]),e}()},62:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(15),a=n(16),s=n(63),o=function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,[{key:"makeReq",value:function(e,t,n){return{type:"REQ",command:e,params:n,id:t}}},{key:"makeScan",value:function(e,t){var n={Timeout:e};return this.makeReq("Scan",t,n)}},{key:"makeConnect",value:function(e,t){var n={MAC:e};return this.makeReq("GATTConnect",t,n)}},{key:"makeDisconnect",value:function(e,t){var n={MAC:e};return this.makeReq("GATTDisconnect",t,n)}},{key:"makeGATTRead",value:function(e,t,n,r){var a={MAC:e,Char:t,Len:n};return this.makeReq("GATTRead",r,a)}},{key:"makeGATTWrite",value:function(e,t,n,r,a){var o={MAC:e,Char:t,Data:Object(s.b)(n),RR:a};return this.makeReq("GATTWrite",r,o)}},{key:"makeGATTSetNotify",value:function(e,t,n,r){var a={MAC:e,Char:t,Enable:n};return this.makeReq("GATTSetNotify",r,a)}},{key:"makeIncomingMsgFromJSON",value:function(e){var t=JSON.parse(e);if("RESP"===t.type)return t;if("UPDATE"===t.type)return t;throw new Error("Unrecognised Incoming Message")}},{key:"updateFromMsg",value:function(e){if("UPDATE"===e.type)return e;throw new Error("Not a T_Update")}},{key:"connStateFromUpdate",value:function(e){if("ConnectionState"===e.update)return e.results;throw new Error("Not a ConnectionState T_Update")}},{key:"scanResultFromUpdate",value:function(e){if("ScanResult"===e.update)return e.results;throw new Error("Not a T_ScanResult")}}]),e}()},92:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return y}));var r=n(18),a=n(15),s=n(16),o=n(19),c=n(20),i=n(10),u=n.n(i),l=n(47),d=n(14),h=n(62),f=n(93),p=function(e){Object(o.a)(n,e);var t=Object(c.a)(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"stringifyKey",value:function(e){return e.toString()}}]),n}(l.a),b=function(e){Object(o.a)(n,e);var t=Object(c.a)(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"stringifyKey",value:function(e){return e.toString()}}]),n}(l.a),g=function(e){Object(o.a)(n,e);var t=Object(c.a)(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"stringifyKey",value:function(e){return e.toString()}}]),n}(l.a),v=function(e){Object(o.a)(n,e);var t=Object(c.a)(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"stringifyKey",value:function(e){return e.MAC+e.Char}}]),n}(l.a),m=function(e){Object(o.a)(n,e);var t=Object(c.a)(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"stringifyKey",value:function(e){return e.MAC.toString()+e.Addr.toString()}}]),n}(l.a),y=function(){function t(e,n){var s=this;Object(a.a)(this,t),this.SeenDevices=new p,this.ConnectedDevices=new b,this.NotifyCallbackMap=new v,this.SentMap=new g,this.LastID=void 0,this.ReadyCallbackMap=new Map,this.MM=void 0,this.URL=void 0,this.Name=void 0,this.WSC=void 0,this.WSCName=void 0,this.MMRMap=new m,this.PendingMMRReads=void 0,this.MAX_ID=1e9,this.isBLEReady=function(){return s.WSC.getReadyState()===WebSocket.OPEN},this._onmessage=function(e){console.log("BLE._onmessage:",e);var t=s.MM.makeIncomingMsgFromJSON(e.data);if(s.PendingMMRReads.length>0&&setTimeout(s._procPendingMMRReads,0),0===t.id)return console.log("BLE","Unsolicited update: ",t),s._handleUnsolicitedUpdate(t);var n=s.SentMap.get(t.id);if(void 0===n)return console.log("BLE","Unknown ID in response: ",t,s.SentMap),!1;console.log("BLE: calling back:",n,t);try{n.cb(n.req,t)||s._forget(t.id)}catch(r){console.log("_onmessage() callback error: ",r)}return!1},this._onstatechange=function(){console.log("_onstatechange: readyState:",s.WSC.getReadyState()),s.WSC.getReadyState()===WebSocket.OPEN&&s.ReadyCallbackMap.forEach((function(e,t,n){t(!0)})),s.WSC.getReadyState()===WebSocket.CLOSED&&(s.reset(),d.c.getInstance().updateKey(s.Name,"DeviceSet",s.SeenDevices,!0),s.ReadyCallbackMap.forEach((function(e,t,n){t(!1)})))},this._handleUnsolicitedUpdate=function(e){if("UPDATE"===e.type&&"GATTNotify"===e.update){var t=e.results,n={MAC:t.MAC,Char:t.Char},r=s.NotifyCallbackMap.get(n);void 0!==r&&r(e)}return!1},this.incId=function(){var e=s.LastID+1;return e>s.MAX_ID?s.LastID=1:s.LastID=e,s.LastID},this.requestScan=function(){var e=Object(r.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=s.incId();try{var a=s.MM.makeScan(t,r);s.SentMap.set(r,{req:a,cb:function(t,r){if("UPDATE"===r.type){var a=s.MM.updateFromMsg(r);if("ScanResult"===a.update){var o=s.MM.scanResultFromUpdate(a),c=s.ConnectedDevices.get(o.MAC)||"DISCONNECTED",i={MAC:o.MAC,Name:o.Name,UUIDs:o.UUIDs,State:c};return o.MAC?(s.SeenDevices.set(o.MAC,i),d.c.getInstance().updateKey(s.Name,"DeviceSet",s.SeenDevices,!0),!0):(e("Scan done"),!1)}}return console.log("ScanResults callback got called with bad data: ",r),n(new Error("ScanResult callback got called with bad data: ".concat(r))),!1}}),s._sendAsJSON(a)}catch(o){console.log("Error in requestScanWithCallbacks:",o),n(new Error("Caught exception in requestScan"))}})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.requestGATTConnect=function(e,t){s._sendRequest(s.MM.makeConnect(e,0),(function(e,n){var r=s.MM.updateFromMsg(n),a=s.MM.connStateFromUpdate(r);return s._updateConnState(a.MAC,a.CState),console.log("BLE: requestGATTConnect response:",a),t(e,a),!1}))},this.requestGATTDisconnect=function(e,t){s._sendRequest(s.MM.makeDisconnect(e,0),(function(e,n){var r=s.MM.connStateFromUpdate(s.MM.updateFromMsg(n));return s._updateConnState(r.MAC,r.CState),console.log("BLE: requestGATTDisconnect response:",r),t(e,r),!1}))},this.requestGATTWrite=function(e,n,r,a,o){s._sendRequest(s.MM.makeGATTWrite(e,n,r,0,a),t._makeResponseTrampoline(o))},this.requestAsyncGATTWrite=function(){var e=Object(r.a)(u.a.mark((function e(t,n,r,a){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,o){s.requestGATTWrite(t,n,r,a,(function(t,n){return e(n),!1}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),this.requestGATTRead=function(e,n,r,a){s._sendRequest(s.MM.makeGATTRead(e,n,r,0),t._makeResponseTrampoline(a))},this.requestAsyncGATTRead=function(){var e=Object(r.a)(u.a.mark((function e(t,n,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){s.requestGATTRead(t,n,r,(function(t,n){return e(n),!1}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.requestGATTSetNotify=function(e,n,r,a,o){var c={MAC:e,Char:n},i=t._makeResponseTrampoline(a);r?(s.NotifyCallbackMap.set(c,o),s._sendRequest(s.MM.makeGATTSetNotify(e,n,r,0),i)):s.NotifyCallbackMap.has(c)&&(s._sendRequest(s.MM.makeGATTSetNotify(e,n,r,0),i),s.NotifyCallbackMap.delete(c))},this.requestAsyncGATTSetNotify=function(){var e=Object(r.a)(u.a.mark((function e(t,n,r,a){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,o){s.requestGATTSetNotify(t,n,r,(function(t,n){return e(n),!1}),a)})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),this.setUpForMMRReads=function(){var e=Object(r.a)(u.a.mark((function e(n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){s.requestGATTSetNotify(n,t.MMRReadChar,!0,(function(t,n){return e(n),!1}),s._wrapWithMAC(n,s._localMMRUpdateCB))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this._wrapWithMAC=function(e,t){return function(n){return t(e,n),!1}},this._localMMRUpdateCB=function(e,n){if("UPDATE"===n.type&&"GATTNotify"===n.update){var r=n,a=t._unpackMMRData(r.results.Data),o=s.MMRMap.get({MAC:e,Addr:a.addr});void 0!==o&&o(!0,e,a.wordlen,a.addr,a.payload),console.log("_locallMMRUpdateCB(".concat(e,", ").concat(n,"):"),a)}return s.PendingMMRReads.length>0&&setTimeout(s._procPendingMMRReads,0),!0},this._procPendingMMRRead=function(){console.log("_procPendingMMRRead length: ",s.PendingMMRReads.length);var e=s.PendingMMRReads.at(0);if(e){var n={MAC:e.mac,Addr:e.mmraddress};if(!s.MMRMap.has(n)){s.PendingMMRReads.shift();var r=e,a=t._packMMRRead(r.wordlen,r.mmraddress);return s.MMRMap.set({MAC:r.mac,Addr:r.mmraddress},r.callback),s.requestGATTWrite(r.mac,t.MMRReadChar,a,!0,(function(e,t){return console.log("blecb: ",e,t),t.success||(s.MMRMap.delete({MAC:r.mac,Addr:r.mmraddress}),r.callback(!1,r.mac,r.wordlen,r.mmraddress,null)),setTimeout(s._procPendingMMRReads,1),!1})),!0}}return!1},this._procPendingMMRReads=function(){do{console.log("PendingMMRReads:",s.PendingMMRReads.length);var e=s._procPendingMMRRead()}while(e)},this.requestMMRRead=function(e,n,r,a){console.log("requestMMRRead");var o={MAC:e,Char:t.MMRReadChar};if(!s.NotifyCallbackMap.has(o))throw new Error("Call setUpForMMRReads() once first, to enable MMR reads");var c={mac:e,mmraddress:n,wordlen:r,callback:a},i=s.PendingMMRReads.push(c);console.log("PendingMMRReads len:",i),console.log("requestMMRRead pushed read: ",s.PendingMMRReads),s._procPendingMMRReads()},this.requestAsyncMMRRead=function(){var e=Object(r.a)(u.a.mark((function e(t,n,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestAsyncMMRRead"),e.abrupt("return",new Promise((function(e,a){s.requestMMRRead(t,n,r,(function(t,r,s,o,c){t&&null!==c?e({mac:r,mmraddress:n,wordlen:s,payload:c}):a(new Error("MMR read to ".concat(r," ").concat(n.toString(16)," failed for unknown reason.")))}))})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.reset=function(){s.SeenDevices.clear(),s.ConnectedDevices.clear(),s.NotifyCallbackMap.clear(),s.SentMap.clear(),s.PendingMMRReads=[]},console.log("BLE.constructor(%s, %s)",e,n),this.PendingMMRReads=[],this.LastID=1,this.MM=new h.a,this.URL=n,this.Name=e,this.WSCName="wsc_"+e,this.WSC=new f.a(this.WSCName,n),this.WSC.addStateNotify(this._onstatechange),this.WSC.setMessageEventHandler(this._onmessage),this.WSC.connect()}return Object(s.a)(t,[{key:"registerForReadyUpdates",value:function(e){this.ReadyCallbackMap.set(e,"")}},{key:"unregisterForReadyUpdates",value:function(e){this.ReadyCallbackMap.delete(e)}},{key:"_forget",value:function(e){this.SentMap.has(e)&&this.SentMap.delete(e)}},{key:"_sendAsJSON",value:function(e){console.log("_sendAsJSON: ",e),this.WSC.send(JSON.stringify(e))}},{key:"requestScanWithCallbacks",value:function(e,t){var n=this,r=this.incId();try{var a=this.MM.makeScan(e,r);this.SentMap.set(r,{req:a,cb:function(e,r){if(console.log("blecb",e,r),"UPDATE"===r.type){var a=n.MM.updateFromMsg(r);if("ScanResult"===a.update){var s=n.MM.scanResultFromUpdate(a),o=n.ConnectedDevices.get(s.MAC)||"DISCONNECTED",c={MAC:s.MAC,Name:s.Name,UUIDs:s.UUIDs,State:o};return s.MAC?(n.SeenDevices.set(s.MAC,c),console.log("BLE",s),d.c.getInstance().updateKey(n.Name,"DeviceSet",n.SeenDevices,!0),t&&t(!1,s),!0):(t&&t(!0,s),!1)}}return!1}}),this._sendAsJSON(a)}catch(s){console.log("Error in requestScanWithCallbacks:",s)}}},{key:"_sendRequest",value:function(e,t){var n=this.incId();e.id=n,this.SentMap.set(n,{req:e,cb:t}),this._sendAsJSON(e)}},{key:"_updateConnState",value:function(e,t){"CONNECTED"===t?this.ConnectedDevices.set(e,t):this.ConnectedDevices.delete(e);var n=this.SeenDevices.get(e);void 0!==n?(n.State=t,this.SeenDevices.set(e,n)):console.log("BLE: Connectionstate received for a device not in SeenDevices: ",e,t),d.c.getInstance().updateKey(this.Name,"DeviceSet",this.SeenDevices,!0)}}],[{key:"asUpdate",value:function(e){return"UPDATE"===e.type?{success:!0,result:e}:{success:!1}}},{key:"asResponseOption",value:function(e){return console.log("asResponse: ",e),"RESP"===e.type?{success:!0,result:e}:{success:!1,error:e.results}}},{key:"_makeResponseTrampoline",value:function(e){return function(n,r){return e(n,t.asResponseOption(r)),!1}}},{key:"_unpackMMRData",value:function(t){var n=e.from(t,"base64");return{wordlen:n[0],addr:(n[1]<<16)+(n[2]<<8)+n[3],payload:n.slice(4)}}},{key:"_packMMRRead",value:function(t,n){var r=new Uint8Array(20),a=[t,n>>16&255,n>>8&255,255&n];return r.set(a,0),e.from(r)}}]),t}();y.MMRReadChar="0000a005-0000-1000-8000-00805f9b34fb"}).call(this,n(121).Buffer)},93:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(15),a=n(16),s=n(14),o=function(){function e(t,n){var a=this;if(Object(r.a)(this,e),this.Name=void 0,this.URL=void 0,this.ReconnectHandle=void 0,this.RetryInterval=void 0,this.MaxRetry=void 0,this.Notifies=void 0,this.Model=void 0,this.OnMessageCallback=void 0,this.WS=void 0,this._on_open=function(){console.log("WebSocket connected"),a._clearReconnectTimeout(),a.notifyStateListeners(),a.Model.updateKey(a.Name,"readyState",a.getReadyState(),!0)},this._on_close=function(e){console.log("Socket is closed. Reconnect will be attempted in ".concat(a.RetryInterval," milliseconds."),e.reason);var t=Math.min(a.MaxRetry,a.RetryInterval+250);a.ReconnectHandle=setTimeout(a.checkConnection,t),a.RetryInterval=t,a.notifyStateListeners(),a.Model.updateKey(a.Name,"readyState",a.getReadyState())},this._on_error=function(e){var t;console.error("Socket encountered error: ",e,"Closing socket"),null===(t=a.WS)||void 0===t||t.close(),a.notifyStateListeners(),a.Model.updateKey(a.Name,"readyState",a.getReadyState(),!0)},this._on_message=function(e){if(a.OnMessageCallback)return a.OnMessageCallback(e)},this.checkConnection=function(){a.WS&&a.WS.readyState!==WebSocket.CLOSED||a.connect()},!t)throw Error("Please specify a name for this controller");if(!n)throw Error("Please specify a url for this controller");console.log("Creating new WSClientController:",t,"for",n),this.Name=t,this.URL=n,this.ReconnectHandle=null,this.RetryInterval=250,this.MaxRetry=1e4,this.Notifies=new Set([]),this.Model=s.c.getInstance(),this.Model.updateKey(t,"url",this.URL),this.Model.updateKey(t,"readyState",WebSocket.CLOSED),this.OnMessageCallback=null,this.WS=null}return Object(a.a)(e,[{key:"_clearReconnectTimeout",value:function(){this.ReconnectHandle&&(window.clearTimeout(this.ReconnectHandle),this.ReconnectHandle=null),this.RetryInterval=250}},{key:"getReadyState",value:function(){var e;return(null===(e=this.WS)||void 0===e?void 0:e.readyState)||WebSocket.CLOSED}},{key:"connect",value:function(){null==this.WS&&(this.WS=new WebSocket(this.URL)),this.WS.readyState!==WebSocket.CLOSED&&this.WS.readyState!==WebSocket.CLOSING||(this.WS=new WebSocket(this.URL)),this.WS.onopen=this._on_open,this.WS.onclose=this._on_close,this.WS.onerror=this._on_error,this.WS.onmessage=this._on_message,this.notifyStateListeners()}},{key:"setMessageEventHandler",value:function(e){console.log("setMessageEventHandler: ",e),this.OnMessageCallback=e}},{key:"send",value:function(e){var t;null===(t=this.WS)||void 0===t||t.send(e)}},{key:"getState",value:function(){return{url:this.URL,readyState:this.getReadyState()}}},{key:"addStateNotify",value:function(e){this.Notifies.add(e)}},{key:"removeNotify",value:function(e){this.Notifies.delete(e)}},{key:"notifyStateListeners",value:function(){this.Notifies.forEach((function(e){e()}))}}]),e}()}},[[135,1,2]]]);
//# sourceMappingURL=main.688ee387.chunk.js.map